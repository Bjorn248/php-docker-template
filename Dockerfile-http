FROM nginx:1.15-alpine as http

# Add usabilla user and group
RUN set -x \
    && addgroup -g 1000 app \
    && adduser -u 1000 -D -G app app

# Env definition
ENV NGINX_DOCUMENT_ROOT="/var/www/html"
ENV NGINX_SERVER_NAME=localhost
ENV NGINX_WORKERS_PROCESSES=1
ENV NGINX_WORKERS_CONNECTIONS=1024
ENV NGINX_KEEPALIVE_TIMEOUT=65
ENV NGINX_EXPOSE_VERSION=off
ENV NGINX_CLIENT_BODY_BUFFER_SIZE=16k

# Nginx helper scripts
COPY src/http/nginx/docker-nginx-* /usr/local/bin/

# Nginx configuration files
COPY src/http/nginx/conf/ /etc/nginx/

CMD ["docker-nginx-entrypoint"]

# Base images don't need healthcheck since they are not running applications
# this can be overriden in the child images
HEALTHCHECK NONE

FROM http as http-dev

ENV NGINX_EXPOSE_VERSION=on
